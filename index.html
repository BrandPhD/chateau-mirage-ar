
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Château Mirage Interactive WebAR</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #000;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      }

      #app {
        position: relative;
        width: 100%;
        height: 100%;
        background: #000;
      }

      /* Camera feed */
      #video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1); /* mirror for more natural feel */
        filter: brightness(1.05) contrast(1.05);
      }

      /* Wrapper that we move around */
      #poster-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) translate3d(0,0,0) scale(1);
        transform-origin: center center;
        will-change: transform;
        pointer-events: auto;
        touch-action: none;
      }

      /* Actual poster with glow + animation */
      #poster {
        width: min(70vw, 480px);
        box-shadow: 0 0 32px rgba(255, 196, 120, 0.6);
        border-radius: 18px;
        overflow: hidden;
        background: radial-gradient(circle at top, rgba(10,0,40,0.9), rgba(0,0,0,0.9));
        animation: breatheGlow 4s ease-in-out infinite alternate;
      }

      #poster img {
        display: block;
        width: 100%;
        height: auto;
      }

      #hud {
        position: absolute;
        left: 50%;
        bottom: 14px;
        transform: translateX(-50%);
        padding: 8px 16px;
        border-radius: 999px;
        background: linear-gradient(to right, rgba(10,0,35,0.78), rgba(40,0,70,0.78));
        color: #f7e6c9;
        font-size: 13px;
        text-align: center;
        max-width: calc(100% - 40px);
        text-shadow: 0 2px 6px rgba(0,0,0,0.6);
      }

      #hud b {
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 11px;
        opacity: 0.95;
        display: block;
        margin-bottom: 2px;
      }

      #errorMessage {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #fff;
        text-align: center;
        padding: 16px;
        display: none;
      }

      @keyframes breatheGlow {
        from {
          box-shadow: 0 0 26px rgba(255, 196, 120, 0.55);
          transform: scale(1.0);
        }
        to {
          box-shadow: 0 0 52px rgba(255, 210, 150, 0.95);
          transform: scale(1.04);
        }
      }
    </style>
  </head>

  <body>
    <div id="app">
      <video id="video" autoplay playsinline muted></video>

      <div id="poster-wrapper">
        <div id="poster">
          <!-- IMPORTANT: make sure this filename exists in the same folder -->
          <img src="chateau-mirage-poster.jpg" alt="Château Mirage Poster">
        </div>
      </div>

      <div id="hud">
        <b>Château Mirage WebAR</b>
        Drag to move · Pinch to resize · Double-tap to recenter
      </div>

      <div id="errorMessage">
        <p>We could not access your camera.</p>
        <p>Please check browser permissions and reload this page.</p>
      </div>
    </div>

    <script>
      // Start camera
      async function startCamera() {
        const video = document.getElementById("video");
        const errorMessage = document.getElementById("errorMessage");

        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: { ideal: "environment" } },
            audio: false
          });
          video.srcObject = stream;
        } catch (e) {
          console.error(e);
          errorMessage.style.display = "block";
        }
      }

      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        startCamera();
      } else {
        document.getElementById("errorMessage").style.display = "block";
      }

      // Interactive WebAR-style controls
      (function () {
        const wrapper = document.getElementById("poster-wrapper");

        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let dragging = false;

        let scale = 1;
        let baseScale = 1;
        let startDist = 0;

        function updateTransform() {
          wrapper.style.transform =
            `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px)) translate3d(0,0,0) scale(${scale})`;
        }

        function dist(touches) {
          const dx = touches[0].clientX - touches[1].clientX;
          const dy = touches[0].clientY - touches[1].clientY;
          return Math.hypot(dx, dy);
        }

        // Touch events (drag + pinch + double-tap)
        let lastTapTime = 0;

        wrapper.addEventListener("touchstart", e => {
          const now = Date.now();
          if (e.touches.length === 1) {
            // Double-tap to recenter
            if (now - lastTapTime < 300) {
              offsetX = 0;
              offsetY = 0;
              scale = 1;
              baseScale = 1;
              updateTransform();
              lastTapTime = 0;
              return;
            }
            lastTapTime = now;

            dragging = true;
            startX = e.touches[0].clientX - offsetX;
            startY = e.touches[0].clientY - offsetY;
          } else if (e.touches.length === 2) {
            dragging = false;
            startDist = dist(e.touches);
            baseScale = scale;
          }
        }, { passive: true });

        wrapper.addEventListener("touchmove", e => {
          if (e.touches.length === 1 && dragging) {
            offsetX = e.touches[0].clientX - startX;
            offsetY = e.touches[0].clientY - startY;
            updateTransform();
          } else if (e.touches.length === 2) {
            const newDist = dist(e.touches);
            if (startDist > 0) {
              const factor = newDist / startDist;
              scale = Math.min(Math.max(0.5, baseScale * factor), 2.5);
              updateTransform();
            }
          }
        }, { passive: true });

        wrapper.addEventListener("touchend", e => {
          if (e.touches.length === 0) {
            dragging = false;
          }
        });

        // Mouse drag (for desktop testing)
        wrapper.addEventListener("mousedown", e => {
          dragging = true;
          startX = e.clientX - offsetX;
          startY = e.clientY - offsetY;
        });

        window.addEventListener("mousemove", e => {
          if (!dragging) return;
          offsetX = e.clientX - startX;
          offsetY = e.clientY - startY;
          updateTransform();
        });

        window.addEventListener("mouseup", () => { dragging = false; });
      })();
    </script>
  </body>
</html>
